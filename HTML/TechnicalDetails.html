<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <title>Technical Details</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; line-height: 1.6; color: #333; padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 800px; margin: 20px auto; background-color: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1, h2, h3, h4 { color: #197b78; margin-top: 25px; margin-bottom: 15px; }
        h1 { font-size: 2.2em; text-align: center; color: #0f4c4c; }
        h2 { font-size: 1.8em; border-bottom: 2px solid #e2f0ef; padding-bottom: 5px; }
        h3 { font-size: 1.4em; color: #3b8a8b; }
        .file-section { margin-bottom: 30px; padding: 15px; border-left: 5px solid #a3e6e4; background-color: #eaf7f7; border-radius: 4px; }
        .file-section h3 { margin-top: 0; }
        .file-section ul { list-style-type: disc; margin-left: 20px; }
        .file-section li strong { color: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Core Components: Script Files (.gs)</h1>
        <hr>

        <div class="file-section">
            <h3><code>config.gs</code></h3>
            <p><strong>Purpose:</strong> This file serves as the central repository for all global configurations and constants used across the application. It defines templates, cell locations, column mappings, BigQuery settings, approval workflow parameters (including status strings), number formats, and UI highlight colors. It also includes general utility functions.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>CONFIG</code> Object:</strong> A global variable holding all application settings, including status string definitions for the approval workflow and granular logging controls.</li>
                <li><strong><code>getColumnIndexByLetter(letter)</code>:</strong> Converts a column letter (e.g., 'A', 'B') to its 1-based numerical index. This is a crucial helper for working with Spreadsheet ranges programmatically.</li>
                <li><strong><code>getLastLastRow(sheet)</code>:</strong> A robust helper function to determine the last row in a sheet that actually contains data, ignoring empty rows or rows with only formatting. This has been optimized for large sheets.</li>
                <li><strong><code>getLastPopulatedRowInColumn(sheet, columnIndex)</code>:</strong> A helper to find the last row with content in a <i>specific column</i>, improving accuracy for data range determination.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Accessed by almost every other script file for configuration settings.</li>
                <li><code>getColumnIndexByLetter</code>, <code>getLastLastRow</code>, and <code>getLastPopulatedRowInColumn</code> are general utilities used widely.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>Logger.gs</code></h3>
            <p><strong>Purpose:</strong> Provides a centralized, high-performance logging utility. It writes detailed activity records to dedicated "Logs" sheets within the Google Spreadsheet and controls console logging based on configurable flags. This system significantly reduces logging overhead.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>Log</code> Object:</strong> An initialized global object (e.g., <code>Log.Main_gs(...)</code>, <code>Log.SheetCoreAutomations_gs(...)</code>) providing file-specific logging methods. This replaces direct <code>Logger.log</code> calls, optimizing performance by eliminating conditional checks on every log invocation.</li>
                <li><strong><code>logActivity(options)</code>:</strong> The primary function for writing structured audit log entries to the dedicated Sheets "TableLogs", "DocumentLogs", "CommunicationLogs", or "GeneralLogs" based on `options.logSheetType`. It dynamically creates necessary columns and is controlled by the <code>CONFIG.logging.sheetLogDisable</code> flag.</li>
                <li><strong><code>_getOrCreateLogSheet(sheetName, headers)</code>:</strong> (Internal helper) Ensures that the designated log sheets exist and have the correct headers.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Accessed by almost every other script file for writing audit logs and debug messages.</li>
                <li>Relies on <code>config.gs</code> for log sheet names, column mappings, and granular logging control flags.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>Main.gs</code></h3>
            <p><strong>Purpose:</strong> This is the primary entry point for the application within the Google Sheet environment. It handles the initial setup (menu creation on open/install) and acts as the central dispatcher for the <code>onEdit</code> trigger, orchestrating various automation flows based on user interactions.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>onOpen(e)</code>:</strong> Triggered when the spreadsheet is opened. Creates custom menus in the Google Sheet UI, ensures log sheets and headers exist, initiates a full sheet refresh (recalculations and, conditionally, formatting), and logs the opening event.</li>
                <li><strong><code>onInstall(e)</code>:</strong> Triggered when the add-on is installed. Calls <code>onOpen</code> to ensure initial setup.</li>
                <li><strong><code>onEdit(e)</code>:</strong> The core automated trigger, running every time a cell is edited. It passes the event object directly to <code>handleSheetAutomations</code> as the single dispatcher for all row-level edits, ensuring efficient in-memory processing.</li>
                <li><strong><code>isConditionalFormattingAlreadySet(sheet)</code>:</strong> A helper to check if conditional formatting rules are already present on the sheet to prevent redundant applications on open.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Calls functions in <code>SheetCoreAutomations.gs</code> (via <code>handleSheetAutomations</code> and <code>recalculateAllRows</code>) and <code>UxControl.gs</code> (for formatting).</li>
                <li>Relies on <code>config.gs</code> for cell locations and other settings.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>BqDtQuery.gs</code></h3>
            <p><strong>Purpose:</strong> Manages the integration with Google BigQuery to fetch product pricing and device details based on SKUs entered in the sheet.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>getDataFromSKU()</code>:</strong> Triggered via the custom menu. Reads SKUs from the sheet, constructs a BigQuery request, fetches data, and updates the sheet with retrieved EP/TK Capex, Rental Target/Limit, and Device Model. It also triggers status updates and calculations for affected rows. This function now features strict logic to prevent unintended data clearing in rows without relevant SKUs.</li>
                <li><strong><code>performBqQuery(uniqueSkusToQuery)</code>:</strong> A helper function that executes the actual BigQuery API call, waits for results, and parses them into a map for easy lookup by SKU.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads configuration from <code>config.gs</code> (BigQuery project ID, table name, column mappings).</li>
                <li>Writes directly to the sheet using fetched data.</li>
                <li>Calls <code>updateStatusForRow</code> (from <code>SheetStatusLogic.gs</code>) to update row statuses after BigQuery data import.</li>
                <li>Calls <code>updateCalculationsForRow</code> (from <code>SheetCoreAutomations.gs</code>) to recalculate LRF/Contract Value.</li>
                <li>Now excludes direct calls to `applyConditionalFormatting` and `applyColumnHighlighting` as these are managed exclusively on `onOpen`.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>DocGenerator.gs</code></h3>
            <p><strong>Purpose:</strong> Handles the generation of Google Docs offer documents based on data in the spreadsheet and user input from an HTML form.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>showOfferDialog()</code>:</strong> Displays an HTML dialog (<code>OfferForm.html</code>) to collect additional offer details from the user. It pre-populates the form with existing sheet data.</li>
                <li><strong><code>processFormSubmission(formData)</code>:</strong> Called from <code>OfferForm.html</code>. Takes form data, updates relevant sheet cells, processes approved device data from the sheet, copies a Google Doc template, and populates it with all collected information.</li>
                <li><strong><code>populateDocContent(doc, formData, customerCompanyName, devicesData, grandTotal, docLanguage)</code>:</strong> Fills the copied Google Doc with general offer details (customer, contact, dates, special agreements) by replacing placeholders.</li>
                <li><strong><code>populateDeviceTable(doc, devicesData, grandTotal, language)</code>:</strong> Populates the device table within the Google Doc using data from approved items in the sheet, ensuring correct formatting.</li>
                <li><strong><code>formatDateForLocale(dateStringYYYYMMDD, language)</code>, <code>parseCurrencyValue(value, language)</code>, <code>formatNumberForLocale(number, language, includeCurrencySymbol)</code>, <code>formatTermForLocale(termValue, language)</code>:</strong> Helper functions for locale-specific data formatting for the generated document.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads/writes to the sheet via <code>CONFIG.offerDetailsCells</code> and device data columns.</li>
                <li>Uses <code>CONFIG.templates</code> to select the correct document template.</li>
                <li>Interacts with <code>OfferForm.html</code> for user input and <code>SuccessDialog.html</code> for confirmation.</li>
                <li>Uses <code>DriveApp</code> and <code>DocumentApp</code> services.</li>
                <li>Calls <code>showSuccessDialog</code> to show the success dialog with the new document URL.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>ApprovalWorkflow.gs</code></h3>
            <p><strong>Purpose:</strong> Contains the core logic for the in-sheet approval workflow, allowing approvers to manage item statuses, either one row at a time via a checkbox or in bulk via a menu option.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>handleApprovalEdit(sheet, rowNum, editedColNum, e, inMemoryRowValues, allColIndexes, originalFullRowValuesFromCaller)</code>:</strong> Triggered by <code>onEdit</code> in <code>Main.gs</code> when the process checkbox column is edited. It processes a single row's approval action (Approve, Reject, Request Revision) using the `inMemoryRowValues` array (which now accurately reflects the checkbox state as a string "TRUE"/"FALSE"). It updates status, approved price, and records approver details directly within the `inMemoryRowValues` array. It ensures immediate UI feedback by flushing changes to the sheet after the in-memory update.</li>
                <li><strong><code>processAllApproverActions()</code>:</strong> Triggered by a menu item. Iterates through all data rows, processes actions (Approve, Reject, Request Revision) for items that have an action selected and are pending approval or revised by AE. It performs batch updates for efficiency.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads/writes sheet data, primarily statuses, prices, and approver comments.</li>
                <li>Relies heavily on <code>config.gs</code> for column mappings and status strings.</li>
                <li>Calls <code>getNumericValue</code> (from <code>SheetCoreAutomations.gs</code>) for numerical parsing.</li>
                <li>Calls <code>updateCalculationsForRow</code> (from <code>SheetCoreAutomations.gs</code>) to update LRF/Contract Value after approval actions.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>AE_Actions.gs</code></h3>
            <p><strong>Purpose:</strong> Provides functionalities for Account Executives (AEs) to submit pending items for approval and optionally add a personal message to the approver.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>submitItemsForApproval()</code>:</strong> Triggered via a menu item. Identifies rows with 'Pending Approval' or 'Revised by AE' status. If such items exist, it opens a dialog (<code>PersonalMessageDialog.html</code>) for the AE to add a message and confirm submission details.</li>
                <li><strong><code>_handlePersonalMessageSubmission(personalMessage, aeName, customerCompany, telekomDeal)</code>:</strong> This is a server-side function called by the <code>PersonalMessageDialog.html</code> client-side script. It receives the user's input from the dialog, updates sheet cells if necessary (e.g., AE name, customer company), and then proceeds to send an approval request email.</li>
                <li><strong><code>sendApprovalRequestEmail(summaryData)</code>:</strong> A helper function that constructs and sends an email notification to the designated approver, summarizing the request and providing a link to the Google Sheet. It uses an HTML template (<code>ApprovalEmail.html</code>).</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads sheet data (status, customer company, AE name, Telekom deal status).</li>
                <li>Interacts with <code>PersonalMessageDialog.html</code> to gather additional input.</li>
                <li>Uses <code>ApprovalEmail.html</code> as an email template.</li>
                <li>Utilizes <code>MailApp</code> service to send emails.</li>
                <li>Relies on <code>config.gs</code> for approver email and column mappings.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>SheetCoreAutomations.gs</code></h3>
            <p><strong>Purpose:</strong> Contains the central logic for automatic calculations and general sheet automations triggered by edits or manual refreshes. It's designed for efficient batch processing of row data.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>recalculateAllRows()</code>:</strong> Performs a full recalculation of LRF and Contract Value for all data rows in the sheet. Data is read into memory, processed, and then written back in a single batch for efficiency. It also calls `updateStatusForRow` to ensure statuses are correct.</li>
                <li><strong><code>handleSheetAutomations(e)</code>:</strong> Triggered by <code>onEdit</code> in <code>Main.gs</code>. This robust function now handles multi-cell pastes by reading the entire relevant data range into memory (`allValuesAfter`), applying the `e.value` (the new value of the edited cell) directly to the corresponding cell in the in-memory array. It then iterates through each row in memory to apply status updates and calculations (via `updateStatusForRow` and `updateCalculationsForRow`), and finally writes all changes back to the sheet in a single `setValues()` call. This ensures data consistency and efficiency during complex edits.</li>
                <li><strong><code>getNumericValue(value)</code>:</strong> Centralized helper function to parse numeric values from various formats (numbers, currency strings with different separators) into clean numbers, ensuring consistent and robust parsing. (Renamed and refactored from `parseCurrencyValue`).</li>
                <li><strong><code>setApproverControlsValidation(sheet)</code>:</strong> A helper function to apply data validation rules for the "Approver Action" dropdown and "Process Action Checkbox" columns in a batch to the entire data range, improving performance during bulk data entry.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads/writes large ranges of data (`getValues`, `setValues`) for efficiency.</li>
                <li>Relies on <code>config.gs</code> for column mappings and status strings.</li>
                <li>Calls <code>updateStatusForRow</code> (from <code>SheetStatusLogic.gs</code>) to update row statuses.</li>
                <li>Crucial for maintaining data integrity and calculated values across the sheet.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>SheetStatusLogic.gs</code></h3>
            <p><strong>Purpose:</strong> Dedicated to managing the status of individual rows based on user input (specifically AE input fields like Model, Sales Price, Quantity, Term, Capex values) and applying relevant data validation rules.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>updateStatusForRow(sheet, rowNum, editedColNum, e, inMemoryRowValues, allColIndexes, originalFullRowValuesFromCaller)</code>:</strong> The core function. It updates the status of a given row within the *in-memory array* (`inMemoryRowValues`) based on the completeness of AE input fields, transitioning status from 'Draft' to 'Pending Approval' when all necessary data is present. Critically, it also handles 'Revision Requested' and 'Approved' items: if key AE input fields are changed on such items, it prompts the user (for single edits) and sets the status to 'Revised by AE - Pending Re-Approval', clearing previous approval data. This function receives the `inMemoryRowValues` array (already updated with the current edit) and modifies it in place.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads/modifies the in-memory row data (`inMemoryRowValues`).</li>
                <li>Relies heavily on <code>config.gs</code> for column mappings, status strings, and UI templates (for copying data validations).</li>
                <li>Called by <code>BqDtQuery.gs</code> (after SKU import) and <code>SheetCoreAutomations.gs</code> (during `recalculateAllRows` and `handleSheetAutomations`).</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>UxControl.gs</code></h3>
            <p><strong>Purpose:</strong> Enhances the user experience by visually highlighting rows and columns based on their status, guiding users (AEs and Approvers) on where input is needed or what status a row is in.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>applyConditionalFormatting()</code>:</strong> Applies background colors, font colors, bolding, italics, and strikethrough to entire rows based on the status in the 'Status' column. This function now clears all existing rules first and is designed to apply a clean set of rules to the *entire potential data range* of the sheet (from `startDataRow` to `getMaxRows()`).</li>
                <li><strong><code>applyColumnHighlighting()</code>:</strong> Applies specific background colors to input columns (AE input fields, Approver input fields) based on the row's status, indicating active areas for different user roles. This function also applies to the *entire potential data range*.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Reads configuration from <code>config.gs</code> for status strings, colors, and column mappings.</li>
                <li>Interacts directly with the `SpreadsheetApp.ConditionalFormatRule` builder to create and apply rules.</li>
                <li>**Now exclusively called on `onOpen`** (conditionally, if no formatting is already present) to set up persistent sheet-level rules, avoiding redundant application during subsequent edits.</li>
                <li>All internal console logging now uses the `Log[sourceFile](...)` pattern defined in `Logger.gs`.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>TestUtilities.gs</code></h3>
            <p><strong>Purpose:</strong> Provides a robust and consistent framework for setting up and tearing down temporary test sheets, ensuring test isolation and repeatability for integration tests.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>withTestSheet(csvData, testFunction)</code>:</strong> A higher-order function that automates the full lifecycle of a test sheet. It creates a new sheet, populates it with `csvData`, executes the provided `testFunction` (passing the sheet object), and then guarantees the sheet's deletion, even if the test fails. This pattern significantly simplifies writing integration tests.</li>
                <li><strong><code>createTestSheet(csvData)</code>:</strong> Internal helper to create and populate a new sheet. Ensures proper padding of data rows to match `CONFIG.maxDataColumn`.</li>
                <li><strong><code>deleteTestSheet(sheet)</code>:</strong> Internal helper to safely delete a sheet and restore active selection.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Used exclusively by test files (`SheetCoreAutomationsTests.gs`, `ApprovalWorkflowTests.gs`).</li>
                <li>Relies on `config.gs` for `maxDataColumn`.</li>
                <li>Uses `SpreadsheetApp` service for sheet manipulation.</li>
            </ul>
        </div>

        <div class="file-section">
            <h3><code>Tests.gs</code></h3>
            <p><strong>Purpose:</strong> Serves as the central test runner for the entire application, orchestrating the execution of unit and integration test suites and providing a consolidated summary of results.</p>
            <h4>Key Functions:</h4>
            <ul>
                <li><strong><code>runAllTests()</code>:</strong> The main entry point for running the entire test suite. It calls `runUnitTests()` and `runIntegrationTests()` sequentially.</li>
                <li><strong><code>runUnitTests()</code>:</strong> Executes all unit test suites (currently `SheetCoreAutomations_UnitTests`).</li>
                <li><strong><code>runIntegrationTests()</code>:</strong> Executes all integration test suites (currently `SheetCoreAutomations_IntegrationTests`).</li>
                <li><strong><code>_addTestMenus(ui)</code>:</strong> A helper to add test-related menu items to the spreadsheet UI for easy execution.</li>
                <li><strong><code>_assertEqual(actual, expected, message)</code>, <code>_assertWithinTolerance(actual, expected, tolerance, message)</code>:</strong> Core assertion functions that compare actual and expected values and record test outcomes.</li>
                <li><strong><code>_assertThrows(func, message)</code>:</strong> Asserts that a given function throws an error.</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Calls test runner functions from dedicated test files (e.g., `SheetCoreAutomationsTests.gs`, `ApprovalWorkflowTests.gs`).</li>
                <li>Uses `Logger.gs` for logging test results and summaries.</li>
                <li>Provides the primary interface for triggering tests via the UI.</li>
            </ul>
        </div>
        
        <div class="file-section">
            <h3><code>UnitTestMockData.gs</code> & <code>IntegrationTestMockData.gs</code></h3>
            <p><strong>Purpose:</strong> Centralized storage for mock data, enhancing test readability, maintainability, and reusability.</p>
            <h4>Key Aspects:</h4>
            <ul>
                <li><strong><code>MOCK_DATA_UNIT</code>:</strong> Contains mock data tailored for unit tests (e.g., in-memory row arrays, mock column indexes). It provides a `get()` method to return deep copies of data, ensuring test isolation.</li>
                <li><strong><code>MOCK_DATA_INTEGRATION</code>:</strong> Contains mock data for integration tests (e.g., CSV strings for sheet population).</li>
            </ul>
            <h4>Interactions:</h4>
            <ul>
                <li>Imported and used by specific test files (`SheetCoreAutomationsTests.gs`, `ApprovalWorkflowTests.gs`) as needed.</li>
            </ul>
        </div>

        <h2>4. Application Orchestration and Workflow</h2>
        <p>The application's functionality is orchestrated primarily through Google Apps Script triggers and client-server interactions, focusing on the following goals:</p>
        <ul>
            <li><strong>Initial Setup & Refresh:</strong> Upon sheet opening or installation, the system aims to create a user-friendly interface with custom menus and ensure all data and formatting are up-to-date. This includes ensuring conditional formatting is applied only once.</li>
            <li><strong>Automated Data Processing on Edit:</strong> The core goal of the <code>onEdit</code> trigger is to automate responses to user input. This now includes a robust bulk processing mechanism for multi-cell pastes, ensuring that all data for a row is considered before status transitions. This aims to:
                <ul>
                    <li>Streamline the approval process by reacting to approver actions (e.e., checkbox edits).</li>
                    <li>Maintain data integrity and consistency by accurately updating row statuses (e.g., from 'Draft' to 'Pending Approval') and recalculating values when key input fields are modified by AEs, even during bulk operations.</li>
                </ul>
            </li>
            <li><strong>Efficient Data Import:</strong> Provide a mechanism for users to seamlessly import external product pricing and device details into the sheet, which then triggers necessary updates to ensure all related calculations and statuses are accurate.</li>
            <li><strong>Seamless Document Generation:</strong> Enable users to generate professional offer documents based on the sheet data and additional user input, ensuring only approved items are included in the final document.</li>
            <li><strong>Automated Approval Request Notifications:</strong> Facilitate the Account Executive's ability to submit items for approval, including the option to add a personalized message, and automatically notify the relevant approvers via email.</li>
            <li><strong>Bulk Approval Management:</strong> Allow approvers to efficiently process multiple approval actions simultaneously, updating their statuses and calculations in a batch for improved performance.</li>
            <li><h3>Priority: Enhanced Logging and Monitoring:</h3>
                <ul>
                    <li>Implement comprehensive logging across the application's execution trace to aid in debugging, performance monitoring, and understanding workflow progression. This now includes granular control flags in <code>config.gs</code> allowing individual `.gs` files' console logging to be toggled on/off, and a separate flag to disable all sheet-based logging (`logActivity`) when detailed tracing is not needed for production. The new `Log` object system significantly optimizes logging performance by pre-evaluating logging conditions.</li>
                </ul>
            </li>
        </ul>

        <h2>5. Performance and UX Considerations</h2>
        <p>The code demonstrates several key performance optimizations typical for Google Apps Script:</p>
        <ul>
            <li><strong>Bulk Operations:</strong> Extensive use of `getValues()` and `setValues()` to read and write data to the spreadsheet in large batches rather than individual cell operations, significantly reducing calls to the Spreadsheet service. This has been refined to handle `onOpen` and `onEdit` events efficiently, especially for bulk data entry.</li>
            <li><strong>Reduced `SpreadsheetApp.flush()`:</strong> While `flush()` is used for immediate UI feedback on single user edits, its usage has been minimized in bulk operations to prevent performance bottlenecks.</li>
            <li><strong>Pre-calculating Column Indexes:</strong> Column indexes are calculated once at the beginning of functions (or passed as arguments) instead of repeatedly within loops, reducing redundant `getColumnIndexByLetter` calls.</li>
            <li><strong>In-memory Data Manipulation:</strong> Data is read into JavaScript arrays, manipulated in memory, and then written back to the sheet in a single batch, which is much faster than interacting with the sheet cell-by-cell.</li>
            <li><strong>Conditional Formatting & Highlighting:</strong> Applied in bulk (and only once on open) after major data changes to ensure visual consistency while avoiding excessive, real-time updates that could slow down editing.</li>
            <li><strong>Optimized Data Validation Application:</strong> Data validation rules for approver actions and checkboxes are now applied in a single batch operation (via `setApproverControlsValidation` in `SheetCoreAutomations.gs`) after all in-memory data processing, significantly improving performance during bulk data entry.</li>
        </ul>

        <p>This architectural breakdown should provide a solid understanding of your Apps Script application's design and operational flow.</p>
    </div>
    <script>
        // Initialize Bootstrap tabs
        $('#myTab a').on('click', function (e) {
            e.preventDefault()
            $(this).tab('show')
        })
    </script>
</body>
</html>