<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <title>Apps Script Application Architecture Overview</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; line-height: 1.6; color: #333; padding: 20px; background-color: #f8f9fa; }
        .container { max-width: 900px; margin: 20px auto; background-color: #ffffff; padding: 30px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1, h2, h3, h4 { color: #197b78; margin-top: 25px; margin-bottom: 15px; }
        h1 { font-size: 2.2em; text-align: center; color: #0f4c4c; }
        h2 { font-size: 1.8em; border-bottom: 2px solid #e2f0ef; padding-bottom: 5px; }
        h3 { font-size: 1.4em; color: #3b8a8b; }
        .file-section { margin-bottom: 30px; padding: 15px; border-left: 5px solid #a3e6e4; background-color: #eaf7f7; border-radius: 4px; }
        .file-section h3 { margin-top: 0; }
        .file-section ul { list-style-type: disc; margin-left: 20px; }
        .file-section li strong { color: #0056b3; }
        .code-snippet { background-color: #e9ecef; padding: 10px; border-radius: 5px; overflow-x: auto; font-family: 'Courier New', Courier, monospace; font-size: 0.9em; }
        .callout { background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; margin-top: 20px; border-radius: 4px; }
        .callout strong { color: #856404; }
        /* Custom styles for tabs */
        .nav-tabs .nav-link {
            color: #197b78;
            border: 1px solid transparent;
            border-top-left-radius: .25rem;
            border-top-right-radius: .25rem;
        }
        .nav-tabs .nav-link.active {
            color: #495057;
            background-color: #e2f0ef;
            border-color: #dee2e6 #dee2e6 #fff;
        }
        .tab-pane {
            min-height: 400px; /* Ensure content area has a minimum height */
            overflow-y: auto; /* Allow scrolling within tab content */
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Apps Script Application Architecture Overview</h1>
        <p class="lead text-center">A deep dive into the structure and functionality of the Offer Generation and Approval Application.</p>
        <hr>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item">
                <a class="nav-link active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true" data-content-func="getOverviewContent">Overview</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="user-guide-tab" data-toggle="tab" href="#user-guide" role="tab" aria-controls="user-guide" aria-selected="false" data-content-func="getUserGuideContent">User Guide</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="offer-doc-tab" data-toggle="tab" href="#offer-doc" role="tab" aria-controls="offer-doc" aria-selected="false" data-content-func="getOfferDocumentDetailsContent">Offer Document</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tech-details-tab" data-toggle="tab" href="#tech-details" role="tab" aria-controls="tech-details" aria-selected="false" data-content-func="getTechnicalDetailsContent">Technical Details</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="code-analysis-tab-nav" data-toggle="tab" href="#code-analysis-tab" role="tab" aria-controls="code-analysis-tab" aria-selected="false" data-content-func="getCodeAnalysisContent">Code Analysis</a>
            </li>
        </ul>

        <!-- Tab Content Panes (Initially Empty, content loaded dynamically) -->
        <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                <!-- Overview content will be loaded here dynamically -->
                <p>Loading Overview content...</p>
            </div>
            <div class="tab-pane fade" id="user-guide" role="tabpanel" aria-labelledby="user-guide-tab">
                <p>Loading User Guide content...</p>
            </div>
            <div class="tab-pane fade" id="offer-doc" role="tabpanel" aria-labelledby="offer-doc-tab">
                <p>Loading Offer Document content...</p>
            </div>
            <div class="tab-pane fade" id="tech-details" role="tabpanel" aria-labelledby="tech-details-tab">
                <p>Loading Technical Details content...</p>
            </div>
            <div class="tab-pane fade" id="code-analysis-tab" role="tabpanel" aria-labelledby="code-analysis-tab-nav">
                <p>Loading Code Analysis content...</p>
            </div>
        </div>
    </div>

    <script>
        // Function to load content into a tab pane
        function loadTabContent(tabId, contentFunction) {
            const pane = $('#' + tabId);
            // Show loading message
            pane.html('<p>Loading content...</p>'); 

            google.script.run
                .withSuccessHandler(function(htmlContent) {
                    pane.html(htmlContent); // Insert the fetched HTML content
                })
                .withFailureHandler(function(error) {
                    pane.html('<p class="text-danger">Error loading content: ' + error.message + '</p>');
                    console.error('Error loading tab content for ' + tabId + ':', error);
                })
                [contentFunction](); // Dynamically call the server-side function
        }

        $(document).ready(function() {
            // Load content for the initially active tab on page load
            const activeTabLink = $('#myTab .nav-link.active');
            if (activeTabLink.length > 0) {
                const activeTabId = activeTabLink.attr('aria-controls');
                const contentFunc = activeTabLink.data('content-func');
                if (contentFunc) {
                    loadTabContent(activeTabId, contentFunc);
                }
            }

            // Set up click listeners for other tabs
            $('#myTab a').on('click', function (e) {
                e.preventDefault();
                const tabId = $(this).attr('aria-controls');
                const contentFunc = $(this).data('content-func');

                // Only load if content hasn't been loaded or if you want to re-load every time
                // For simplicity, we'll load content every time the tab is clicked.
                if (contentFunc) {
                    loadTabContent(tabId, contentFunc);
                }
                $(this).tab('show'); // Activate the clicked tab
            });
        });
    </script>
</body>
</html>
